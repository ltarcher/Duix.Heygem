# 数字人视频制作核心逻辑流程

## 1. 整体流程概述

```mermaid
graph TD
    A[开始] --> B[准备数字人模型]
    B --> C[准备音频]
    C --> D[合成视频]
    D --> E[完成]
```

## 2. 数字人模型制作流程

```mermaid
graph TD
    A[开始] --> B[上传模型视频]
    B --> C[上传模型音频]
    C --> D[设置模型参数]
    D --> E[保存模型信息]
    E --> F[模型训练]
    F --> G[完成]

    subgraph 数据存储
    H[(模型信息表)]
    end

    E --> H
```

## 3. 声音合成流程

```mermaid
graph TD
    A[开始] --> B[输入文本]
    B --> C[选择声音模型]
    C --> D[预处理文本]
    D --> E[TTS转换]
    E --> F[生成音频文件]
    F --> G[完成]

    subgraph 数据存储
    H[(声音信息表)]
    end

    C --> H
```

## 4. 视频合成流程

```mermaid
graph TD
    A[开始] --> B[创建视频任务]
    B --> C[生成音频]
    C --> D[提交F2F任务]
    D --> E[轮询任务状态]
    E --> F[更新视频状态]
    F --> G{是否完成?}
    G -->|否| E
    G -->|是| H[完成]

    subgraph 数据存储
    I[(视频信息表)]
    end

    B --> I
    F --> I
```

## 5. 数据流转关系

```mermaid
graph TD
    A[数字人模型] --> D[视频合成]
    B[声音模型] --> C[音频生成]
    C --> D
    D --> E[最终视频]

    subgraph 数据库
    F[(模型信息表)]
    G[(声音信息表)]
    H[(视频信息表)]
    end

    A --> F
    B --> G
    D --> H
```

## 6. 核心API调用流程

### 6.1 视频合成API
- `makeVideo(param)`: 提交视频制作任务
- `getVideoStatus(taskCode)`: 查询视频制作任务状态

### 6.2 音频合成API
- `makeAudio(param)`: 生成音频文件
- `preprocessAndTran(param)`: 预处理和转换音频

## 7. 状态管理

### 7.1 视频状态
- 待处理
- 处理中
- 已完成
- 失败

### 7.2 处理流程
1. 创建视频任务，初始状态为"待处理"
2. 系统定期检查待处理任务
3. 开始处理时更新状态为"处理中"
4. 处理完成后更新状态为"已完成"或"失败"

## 8. 文件管理

### 8.1 音频文件
- 原始音频文件
- 预处理后的音频文件
- 生成的TTS音频文件

### 8.2 视频文件
- 模型训练视频
- 生成的数字人视频
- 最终合成视频

## 9. 注意事项

1. 模型制作
   - 确保模型视频质量
   - 保证音频清晰度
   - 正确设置模型参数

2. 音频处理
   - 文本预处理
   - 音频格式转换
   - 音频质量控制

3. 视频合成
   - 任务状态监控
   - 错误处理机制
   - 资源清理

4. 数据管理
   - 定期数据备份
   - 文件存储管理
   - 状态同步维护